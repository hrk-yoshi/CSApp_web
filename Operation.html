<!-- home.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="CSS/style.css" type="text/css">
    <!-- <script src="scripts/issueTree.js"></script> -->

    <title>Home</title>
</head>

<body>
    <header id="header">
        <a id="homeLink" href="#" class="app-name">
            <img src="images/AppIcon_t.png" alt="ä¿®ç†ä¾é ¼icon">
            <span class="title">ãŠå®¢æ§˜ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ—ãƒª</span>
        </a>
        <span class="welcome"></span>
    </header>

    <h1>æ“ä½œå•ã„åˆã‚ã›</h1>
    <h3>ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</h3>
    <div class="issueRoot"></div>
    <div id="contentArea"></div>

    <script>
        // ====== ãƒ‡ãƒ¼ã‚¿å®šç¾© ======
        const issueTree = {
            "root": [
                { id: "1", name: "ã‚µãƒ—ãƒ©ã‚¤/æ¶ˆè€—å“", img: "images/TonerChange.png" },
                { id: "2", name: "ãã®ä»–", img: "images/OI_t.png" }
            ],
            "1": [
                { id: "1-1", name: "ã‚µãƒ—ãƒ©ã‚¤/æ¶ˆè€—å“ã®äº¤æ›æ–¹æ³•", img: "images/TonerChange.png" },
            ],
            "1-1": {
                faq: [
                    { name: "ğŸ’¡ ãƒˆãƒŠãƒ¼äº¤æ›æ‰‹é †", url: "https://faq.ricoh.jp/app/answers/ch_detail/mode/2/a_id/2261" },
                    { name: "ğŸ’¡ å»ƒãƒˆãƒŠãƒ¼ãƒœãƒˆãƒ«äº¤æ›æ‰‹é †", url: "https://faq.ricoh.jp/app/answers/ch_detail/mode/2/a_id/2225" }
                ]
            },
            "2": {
                faq: [
                ]
            }
        };
        // ====== DOMæ§‹ç¯‰ãƒ­ã‚¸ãƒƒã‚¯ ======
        const contentArea = document.getElementById("contentArea");
        const issueRoot = document.querySelector(".issueRoot");

        let currentLevel = "root";
        function renderContent(level) {
            contentArea.innerHTML = "";
            const data = issueTree[level];
            const h3 = document.querySelector("h3");
            const container = document.createElement("div");
            container.className = "issueContainer";

            // ===== ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆç”Ÿæˆ =====
            issueRoot.innerHTML = ""; // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ

            if (level !== "root") {
                const parts = level.split("-");
                let path = "";

                parts.forEach((p, i) => {
                    path = path ? `${path}-${p}` : p; // ä¾‹: 1 â†’ 1-1 â†’ 1-1-1

                    let label = "";
                    if (i === 0) {
                        const found = issueTree["root"].find(el => el.id === path);
                        label = found ? found.name : "";
                    } else {
                        const parentPath = path.slice(0, path.lastIndexOf("-"));
                        const found = issueTree[parentPath]?.find(el => el.id === path);
                        label = found ? found.name : "";
                        
                    }

                    // ãƒ©ãƒ™ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆï¼ˆFAQéšå±¤ãªã©ï¼‰
                    if (!label && issueTree[path]?.faq) {
                        label = "FAQ";
                    }

                    const crumb = document.createElement("span");
                    crumb.textContent = label || "ä¸æ˜";
                    crumb.className = "breadcrumb";



                    // ã‚¯ãƒªãƒƒã‚¯ã§ä¸Šä½éšå±¤ã¸æˆ»ã‚‹
                    crumb.onclick = () => renderContent(path);

                    issueRoot.appendChild(crumb);

                    // åŒºåˆ‡ã‚Šã€Œ>ã€
                    if (i < parts.length - 1) {
                        const sep = document.createElement("span");
                        sep.textContent = " > ";
                        issueRoot.appendChild(sep);
                    }
                });
            }

            // ---- topRowç”Ÿæˆï¼ˆå…±é€šï¼‰ ----
            const topRow = document.createElement("div");
            topRow.className = "topRow";

            const backBtn = document.createElement("button");
            backBtn.className = "backBtn";
            backBtn.textContent = "â†";
            backBtn.onclick = () =>
                renderContent(level.includes("-") ? level.slice(0, level.lastIndexOf("-")) : "root");
            topRow.appendChild(backBtn);

            // FAQãƒšãƒ¼ã‚¸ãªã‚‰ã€Œä¾é ¼ã™ã‚‹ã€ãƒœã‚¿ãƒ³è¿½åŠ 
            if (data.faq) {
                const requestBtn = document.createElement("a");
                requestBtn.href = "contactPerson.html?from=faq";
                requestBtn.className = "btn requestBtn";
                requestBtn.textContent = "ä¾é ¼ã™ã‚‹";
                topRow.appendChild(requestBtn);
            }

            // rootéšå±¤ãªã‚‰æˆ»ã‚‹ã¯å±¥æ­´æˆ»ã‚Š
            if (level === "root") {
                backBtn.onclick = () => history.back();
            }

            // ---- FAQãƒšãƒ¼ã‚¸ã®å ´åˆ ----
            if (data.faq) {
                if (h3) h3.textContent = "ã”é¸æŠã„ãŸã ã„ãŸå†…å®¹ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§æ”¹å–„ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚";
                const faqList = document.createElement("div");
                faqList.className = "insideContent";
                // faqList.innerHTML = `<p></p>`;
                if (!data.faq || data.faq.length === 0) {
                    window.location.replace("contactPerson.html?from=faq");
                } else {
                    data.faq.forEach(faq => {
                        const btn = document.createElement("button");
                        btn.className = "faq-content";
                        btn.textContent = faq.name;
                        btn.onclick = () => location.href = `faq.html?link=${encodeURIComponent(faq.url)}`;
                        faqList.appendChild(btn);

                    });
                }

                container.appendChild(faqList);
                container.appendChild(topRow);

            } else if (Array.isArray(data)) {
                // ---- é€šå¸¸ã®é¸æŠè‚¢ãƒšãƒ¼ã‚¸ ----
                if (h3) h3.textContent = "ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"
                data.forEach(issue => {
                    const btn = document.createElement("button");
                    btn.className = "iconBtn";
                    if (issue.img) {
                        btn.innerHTML = `<img src="${issue.img}" alt="">${issue.name}`;
                    } else {
                        btn.textContent = issue.name;
                    }
                    if (issue.disabled) btn.disabled = true;
                    btn.onclick = () => {
                        localStorage.setItem("selectedContentId",issue.id);
                        localStorage.setItem("selectedContentName",issue.name);
                        console.log(issue.id, issue.name);
                        renderContent(issue.id);
                    }
                    container.appendChild(btn);
                });
                container.appendChild(topRow);

            } else {
                // ---- æƒ³å®šå¤–ãƒ‡ãƒ¼ã‚¿ï¼ˆä¿é™ºï¼‰----
                container.innerHTML = "<p>ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚</p>";
            }

            // æç”»
            contentArea.appendChild(container);
        }


        renderContent("root");

        const kisyu = localStorage.getItem("kisyu");
        const kiban = localStorage.getItem("kiban");
        const homeLink = document.getElementById("homeLink");

        if (kisyu && kiban) {
            homeLink.href = `index.html?machineSn=${kisyu}-${kiban}`;
            const welcomeSpan = document.querySelector(".welcome");
            welcomeSpan.innerHTML = `<div class="machineSn">ã”åˆ©ç”¨ä¸­ã®æ©Ÿå™¨<br>[ ${kisyu}-${kiban} ]</div>`;
        }
    </script>


</body>

</html>